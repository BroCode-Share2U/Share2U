{% extends "layout.html.twig" %}

{% block title '' %}

{% block content %}
    <style>
        tr.itemSelect{
            background-color: #00fa00;
        }
    </style>

    <div style="width: 300px; margin: auto">
        <form id="formSearchIgdb" action="" method="post">
            <label for="inputSearch"></label>
            <input id="inputSearch" name="inputSearch">
            <button type="submit">submit</button>
        </form>
    </div>

    <div id="tableResultSearch" style="display: none">
        <h2>Games</h2>
        <table>
            <thead>
            <tr>
                <th>Cover</th>
                <th>Name</th>
                <th>Summary</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="divFormAdd" style="width: 300px; margin: auto; display: none">
        {{ form(itemForm) }}
    </div>

    <div style="height: 200px"></div>
    <script>
        $(function ()
        {
            var tableResultSearch = $('#tableResultSearch');
            var formSearchIgdb = $('#formSearchIgdb');

            formSearchIgdb.on('submit', function (e) {
                e.preventDefault();
                var dataForm = $(this).serialize();
                $.ajax({
                    url: "{{ path('searchIgdb') }}",
                    data: dataForm,
                    method: "GET",
                    dataType: "JSON"
                })
                    .done(function (data) {
                        addGamesInTable(data);
                    })
            });

            function addGamesInTable(games)
            {
                tableResultSearch.find('tbody').html('');

                for (var i=0; i<games.length; i++){
                    if ( games[i].cover === undefined)
                    {
                        games[i].cover = { url : 'http://www.psdgraphics.com/file/blank-paper-transparent-png.png'};
                    }
                    if ( games[i].summary === undefined)
                    {
                        games[i].summary = '';
                    }
                    tableResultSearch.find('tbody').append(
                        '<tr data-id="' + games[i].id + '" data-name="' + games[i].name + '" data-summary="' + games[i].summary + '" >' +
                            '<td>' + '<img src="' + games[i].cover.url + '" alt="" style="width: 100px">' + '</td>' +
                            '<td>' + games[i].name + '</td>' +
                            '<td>' + games[i].summary + '</td>' +
                        '</tr>'
                    )
                }
                tableResultSearch.fadeIn(300);
                $('#divFormAdd').fadeIn(300);
                addListenerTr();
            }

            function addListenerTr()
            {
                $('tr').on('click', function ()
                {
                    $('.itemSelect').removeClass('itemSelect');
                    $('#item_form_igdbId').val($(this).data('id'));
                    $('#item_form_name').val($(this).data('name'));
                    $('#item_form_summary').val($(this).data('summary'));
                    $('#item_form_cover').val($(this).find('img').attr('src'));
                    $(this).addClass('itemSelect');
                });
            }
        }); // Fin JQUERY
    </script>
{% endblock %}